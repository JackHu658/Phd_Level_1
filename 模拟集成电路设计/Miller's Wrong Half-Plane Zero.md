# Miller's Wrong Half-Plane Zero

## 文献

>C. Mangelsdorf, "Miller’s Wrong Half-Plane Zero [Shop Talk: What you didn’t Learn in School]," in IEEE Solid-State Circuits Magazine, vol. 17, no. 2, pp. 19-29, Spring 2025

## 前馈通路会导致一个右半平面零点

![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-1.png>)
当使用(i)的补偿方法时，由于电容的阻抗会随频率的升高而降低，更多的信号可以绕过第二级增益，直接传输到输出端。这部分传输到输出端的信号会增加，这种特性与实轴零点相关。但为什么它是一个右半平面（RHP）零点，而不是左半平面（LHP）零点呢？
一个“正常的”左半平面（LHP）零点会减小信号路径中的相移，这就是我们使用它来消除不需要的极点所造成影响的原因。但由于前馈通路与主信号路径不一致（相位是相反的），会使相位变差。因此，零点位于右半平面（RHP）。下图展示了这一情况：
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image.png>)
图（a）中可以看出当频率逐渐升高时，左半平面零点的相位是增加的，而右半平面零点的相位随着频率的升高逐渐下降；
图（b）中将米勒电容引起的前馈电流与第二级的跨导（gm）电流进行矢量组合，同时应用于反相级和同相级。反相级的前馈会减小相位，这种行为通常与极点相关。

任何类型的零点在穿越频率附近都可能成为问题，因为它会提升增益，并将穿越频率推高到有其他极点潜伏的更高频率处。但至少左半平面零点能让相位有所改善。右半平面零点则不然：它在将穿越频率推向无穷大的同时，还会侵蚀相位裕度。而且，在设计中，这种密勒前馈右半平面零点不可避免地会出现在穿越频率附近，甚至低于穿越频率。下图中的红色曲线展示了这种情况会有多糟糕。
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-2.png>)

## 为什么Bipolar放大器不会有这个RHP零点问题

许多资料会告诉你，双极放大器不易受右半平面零点问题的影响，因为双极晶体管比MOS具有更高的跨导。

只考虑有一个米勒电容的情况，当频率足够高的时候，这就相当于短接，第二级就是一个二极管连接的MOS管。第二级的增益由低频时的反向增益变为了正向增益，这种增益符号的改变就对应了RHP零点！
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-3.png>)

接下来你可能想知道的是这个右半平面零点在频域中会出现在哪里。但这是个错误的问题。**真正重要的是当零点起作用时环路传输的幅度**。如果它发生在环路增益远低于1的地方，就不太可能成为问题。如果它发生在环路增益大于1的地方，你就需要处理它。

在频率足够高的时候因为第二级就相当于二极管连接的MOS管，所以整体的增益是$G_{m1}/G_{m2}$。如果$G_{m1}/G_{m2}$约为1或更大，意味着在正向增益降至远低于1之前零点已起作用。如果放大器的全局反馈设置为单位增益，那么稳定性将出现问题。

在通过调整跨导来解决右半平面零点问题之前，还有一件事：负载电容的影响

下图中的C2，会分流掉一部分来自Gm2的电流，因此有效跨导会减小为原来的$\frac{C_{Miller}}{C_{Miller}+C_2}=0.23$倍，之前以为的$G_{m1}/G_{m2}=1$实际上是错误的，实际上：$G_{m1}/G_{m2}=4.3$，会造成更严重的右半平面零点稳定性问题
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-1.png>)

现在让我们回到双极型放大器为什么RHP零点问题不那么严重的问题上来：

+ 在早期的双极型工艺中，电源轨到轨幅度是很大的，“大力出奇迹”，因此增益能做得很高，早期的人们为了提高摆率，会把第一级gm做的很低，而第二级的增益做得很高，在741中第二级的gm是第一级的34倍，因此右半平面零点并不会成问题。第一级的目的仅仅是实现具有良好共模抑制比、低噪声和低失调的差分至单端转换，所有增益均在第二阶段实现。
+ 但在现代CMOS工艺中，电源轨到轨摆幅很小，第二级的输出需要尽可能高的输出范围，因此并不能够借助提升输出阻抗的方式提升第二级的增益（这通常会降低输出裕度），只有在第一级中设置高增益（这有助于改善噪声性能）。这会导致$G_{m1}/G_{m2}>1$

## 电阻如何解决这个问题？

通常的，我们会根据小信号模型去计算零点的位置，然后将这个RHP零点移到LHP或者是无穷远处，但在此处我们会看到这种代数计算与实际情况并不是完全相符的。

理论上，电阻可以放置在Miller电容的任意一侧。但在实际应用中，电容的下极板通常连接到第二级的输出端，这样较大的下极板寄生电容会加载到输出端，而不是敏感的级间节点。如果存在下极板寄生电容，不应通过调零电阻将其与输出端隔离开来。此外，过去通常尝试通过使用不饱和晶体管来构成调零电阻，以跟踪第二级对PVT敏感的跨导Gm。在这种情况下，电阻也应位于Miller电容的输入端一侧。

### 第一种理解

右半平面零点的产生是因为流过密勒电容的前向电流超过了第二级增益晶体管的跨导。如果在密勒电容串联一个小电阻，电流就会减小，此时前向电流与跨导电流相等的点会出现在更高的频率处，而在该频率下密勒电容的阻抗更低。随着调零电阻的增大，零点会移向越来越高的频率。最终，当电阻增大到一定程度时，即使电容被短路，电流也无法与跨导电流匹配。此时零点似乎位于无穷远处，这意味着它已经消失了。

到目前为止的讨论中，电阻器上的压降一直很小。它只是阻止来自级间节点的信号，与驱动反馈的输出摆幅相比，该信号很小。如果进一步增大调零电阻，前馈电流永远无法超过跨导级，但电阻器开始影响反馈。电阻器开始将反馈路径从容性转变为阻性。因此，在高频时，跨导级的积分器特性变成简单的增益级，前向增益停止下降。换句话说，电阻器产生了一个零点，但这次是一个左半平面零点，相位开始改善。现在，进一步增大电阻会将零点推向越来越低的频率。这就是为什么经常会看到这样的图示：米勒零点被推至正无穷大，然后神奇地出现在负无穷大，接着开始向零移动。
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-4.png>)

### 第二种理解

如下图所示，在这里只考虑从第一级输出到第二级的部分。第一级的作用可以被看成是一个恒定的电压源$V_X$（因为第一级的输出幅度和相位都是恒定的）
可以看出这个RC网络具有两个驱动源，一个是电压源通过前馈影响，一个是电压源控制的压控电流源进行feedback式影响输出
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-5.png>)
让我们暂时忽略$R_2,C_2$

+ 当$R_{null}=0\Omega$时，$V_{null}$跟随着$V_X$的变化，随着$V_X$的升高，$V_{null}$电压升高。由于电压源和电流源的竞争作用，输出端电压可以有不同的变化趋势：当频率较低时，$C_{miller}$电容阻抗较大，此时电流源胜出，输出端电压被下拉；当频率升高时，电容阻抗减小，此时电压源胜出，反而将节点上拉。当$V_{out}=V_{X}$时，代表增益为1——0dB，此时对应的就是RHP零点
+ 当$R_{null}\neq 0$，电流源经过$R_{null}$会形成一个压降：$V_{null}=V_X-G_{m2}V_XR_{null}$，当$R_{null}=1/G_{m2}$时，$V_{null}$形成一个虚拟地，前馈路径被切断了，且$C_{miller}$还在实实在在地被$G_{m2}$驱动
+ 当$R_{null}>1/G_{m2}$，$V_X$的增加量还没有$V_{null}$的下降多，导致$V_X$和$V_{null}$反相，哪怕在高频处，$C_{miller}$被短路，此时$V_{null}$照样是和$V_X$反相，这对应了LHP零点

## Null电阻的取值

之前我们所推导的零点位置是：
$$\omega_z = \frac{1}{C_{miller}(G_{m2}^{-1}-R_{null})}$$
这个结果表明零点的位置并不受第二级负载的影响，但实际上并非如此
从Figure 5中可以看出，$G_{m2}$驱动$R_2,C_{miller},C_2$，在高频时，负载主要由电容决定，因此可以忽略电阻$R_2$，这个时候大约只有23%的电流会从$C_{miller}$走，也就是说选择$R_{null}=1/G_{m2}$并不是最优的，此时的等效$G_m=0.23G_{m2}$，我们需要选择的$R_{null}=1/(0.23G_{m2})=87\Omega$，只有这样才会使得$V_{null} \approx 0$，从而彻底断开前馈路径

下图所示是第二级的幅频相频传递函数波特图，当考虑$C_2$时，可以看到$R_{null}=87\Omega$的时候只有一个极点，没有零点；而当不考虑$C_2$的时候，$R_{null}=20\Omega$的时候才没有零点，和传统的代数推导答案一致，这个时候若取$R_{null}=87\Omega$代表零点已经变为LHP零点。
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-6.png>)
当零点没有被消除时，Miller反馈路径依旧存在，这个时候$R_{null}$必定会在电路中引入另一个极点，零点和极点会在高频处出现

同时在“Miller's Secret”这篇文章中我们知道，整体开环的两个极点是由第一级、第二级传递函数零极点相互“接力”的过程，第二级的输入阻抗会在某个频段呈现出阻性

在$f>(R_2C_2)^{-1}$时，第二级增益开始滚降，输入阻抗保持恒定
若$R_{null}≠1/G_{me}$，那么第二级输入阻抗的变化则对应上图中蓝线所示的情况，这意味着第一级的增益中还存在一个零极点对，这会产生一些不好的影响
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-7.png>)

## Source Follower

让信号只能反馈不能前馈，从而消除RHP零点，同时，这种结构还能防止米勒电容（包括底板的寄生）对输出节点的加载
但是这种方法在实际情况下并不流行，因为：

+ 没有人喜欢电路中多出一条电流分支
+ 它在反馈路径上增加了电压偏移，这不会影响交流性能，但确实限制了输出端的大信号摆幅
+ 电流必须足够大来处理压摆率，以便跟随器的输出电阻不会导致麻烦的零点重新出现在一个坏的地方。(这是一个LHP零点，但它仍然会造成麻烦。)

![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-9.png>)

## Current Buffer

下图展示了两种不同的电流缓冲级的连接方法，在不同的应用环境中，两种接法各有优劣
![alt text](<Pictures/Miller's Wrong Half-Plane Zero-image-12.png>)
Ahuja解决方案通常需要电流源匹配来防止直流输入偏置，而Saxena/Baker方法仍然允许一些前馈，因为$M_{buf}$的$G_m$有限，导致部分电流会从$C_{miller}$直接通向输出端，$M_{buf}$流过的现在除了反馈电流外，还可以传递信号电流。
